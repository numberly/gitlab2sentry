# gitlab2sentry

This project aims to automate Sentry project creation. Moreover it aims to create a sentry project for every gitlab team's project.

Read the documentation in the [Numberly Handbook](https://pages.numberly.in/numberly/handbook/Numberly/Software/Sentry%20at%20numberly/).

The script aims to add sentry to each project by 2 steps.
1. Creating the sentryclirc file inside the repo with the First MR (sentryclirc_mr)
2. After the merge of the first MR, it will create the sentry-project (if not already exists)
and it will create the second MR which adds the dsn details inside the .sentryclirc file.

## Installation

You can install all requirements for this project with
```
pip3 install -r requirements.txt
```


## Usage

In order to make gitlab2sentry run you have to export some env variables:

```
SENTRY_URL = <your sentry server's url>
SENTRY_TOKEN = <your sentry auth token>
SENTRY_DSN = <your sentry DSN url>
SENTRY_ENV = <production | development>
GITLAB_URL = <your gitlab's server url>
GITLAB_TOKEN= <your gitlab token>
```

then you can run:
```
SENTRY_URL=... {all your variables} make run
```


## Configuration

Gitlab2Sentry has a yaml file which configures the behavior of the script.
```
sentry:
  # Sentry configuration.
  slug: <your sentry organization>
gitlab:
  # DSN MR configuration.
  dsn_mr:
    # Default values for configuration.
    content: |
      ## File generated by gitlab2sentry
      [defaults]
      url = {sentry_url}
      dsn = {dsn}
    description: <your description in the DSN MR>
    branch_name: <default dsn branch name>
    title: <default title of the dsn mr>
  # Sentryclirc MR configuration.
  sentryclirc_mr:
    content: |
      ## File generated by gitlab2sentry
      [defaults]
      url = {sentry_url}
    description: <your description in the sentryclirc MR>
    branch_name: <your sentryclirc branch_name
    filepath: .sentryclirc
    commit_message: <commit message>
    title: <default title of the sentryclirc mr>
  # Gitlab configuration.
  config:
    author:
      name: <name>
      email: <email>
    graphql_suffix: <endpoint of gitlab graphql>
    mentions:
      - "@<mention>
      - # everyone you want to include on those MRs
    keyword: sentry
    creation_days_limit: 60
    remove_source: true
    group_identifier: <define a keyword for the groups you want to include>
    graphql_aiohttp_timeout: 40
    graphql_page_length: 100

```